<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URL Redirect Checker</title>
  </head>
  <body>
    <link
      href="https://ik.imagekit.io/rehres/sites/twdv1.2.css"
      rel="stylesheet"
    />

    <div class="relative px-4 mx-auto">
      <div class="max-w-3xl mx-auto">
        <form class="sm:flex items-center mb-4" id="check-form">
          <input
            class="input w-full mb-3 sm:mb-0 sm:mr-4 py-4 px-6 rounded-[4px] text-gray-500 placeholder-gray-400 border border-gray-200 focus:border-purple-500 focus:outline-purple"
            id="url"
            placeholder="Enter a link to expand it"
            value="redirhub.com"
            required
          />
          <button
            id="make-btn"
            class="relative group sm:flex-shrink-0 inline-block w-full sm:w-auto py-4 px-6 text-center text-white bg-black hover:bg-[#5D2DFF] transition-all font-semibold rounded-[4px] overflow-hidden"
            type="submit"
          >
            <span class="relative" id="check-btn">Check</span>
          </button>
        </form>

        <div class="relative mb-8 px-6 py-4 overflow-hidden rounded-xl">
          <div class="absolute top-0 left-0 w-full h-full bg-gray-400"></div>
          <div
            class="relative z-10 flex flex-wrap items-center justify-between -m-2"
          >
            <div class="w-2/3 p-2">
              <h3 class="font-heading text-lg text-white !pb-0">
                Looking to redirect your URLs?
              </h3>
            </div>
            <div class="w-auto p-2">
              <a
                class="inline-flex flex-wrap items-center px-5 py-3.5 text-sm text-black font-semibold rounded-lg transition duration-300 bg-[#00DFAA] hover:bg-[#1affc9]"
                href="https://app.redirhub.com/"
                target="_blank"
                rel="noopener"
                ><span class="mr-3 font-semibold">Start for free</span>
                <svg
                  width="16"
                  height="16"
                  viewbox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9.33333 3.33337L14 8.00004M14 8.00004L9.33333 12.6667M14 8.00004L2 8.00004"
                    stroke="black"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></path>
                </svg>
              </a>
            </div>
          </div>
        </div>

        <div id="expanded-results" class="mt-5"></div>

        <div
          class="px-4 mx-auto relative z-10 bg-slate-200 hidden"
          id="cost-card"
        >
          <div
            class="max-w-xl mx-auto text-center py-10 md:py-12 px-6 md:px-14"
          >
            <h2 class="text-2xl font-heading">
              Cost <span id="cost-time"></span> s
            </h2>
            <p class="max-w-md mx-auto leading-8 mb-5">
              Checked at <span id="cost-at"></span>
            </p>
            <div>
              <a
                id="check-again-btn"
                class="inline-block px-8 py-3 text-white font-semibold bg-black hover:bg-[#5D2DFF] rounded"
                href="javascript:;"
                >Check Again</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="hidden">
      <span id="label-check">Analyze</span>
      <span id="label-expanding">Analyzing...</span>
      <span id="label-show-more">Show More</span>
      <span id="label-show-less">Show Less</span>
      <span id="label-status-code">Status code:</span>
      <span id="label-taken">taken:</span>
    </div>

    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", function () {
        const baseUrl = "https://performance.urlredirectservice.com/api";
        const expandForm = document.getElementById("check-form");
        const urlInput = document.getElementById("url");
        const expandBtn = document.getElementById("check-btn");
        expandBtn.innerHTML =
          document.getElementById("label-check").textContent;

        function formatDateTimeByTimestamp(timestamp) {
          const date = new Date(timestamp * 1000);

          const year = date.getFullYear();
          const month = date.getMonth() + 1;
          const day = date.getDate();
          const hours = date.getHours();
          const minutes = date.getMinutes();
          const seconds = date.getSeconds();

          const formattedDate = `${year}-${month
            .toString()
            .padStart(2, "0")}-${day.toString().padStart(2, "0")}`;
          const formattedTime = `${hours.toString().padStart(2, "0")}:${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          return formattedDate + " " + formattedTime;
        }

        // get query variable
        function getQueryVariable(variable) {
          var query = window.location.search.substring(1);
          var vars = query.split("&");
          for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
              return pair[1];
            }
          }
          return false;
        }
        const urlParam = getQueryVariable("url");
        if (urlParam) {
          urlInput.value = urlParam;
        }

        function expandUrl(url, refresh = false) {
          return fetch(`${baseUrl}/redirects`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              url: url,
              refresh,
            }),
          }).then((response) => response.json());
        }

        const submitFunc = (refresh = false) => {
          const url = urlInput.value;
          document.getElementById("expanded-results").innerHTML = null;
          expandBtn.innerHTML =
            document.getElementById("label-expanding").textContent;

          expandUrl(url, refresh)
            .then((res) => {
              if (res.error) {
                const noresult = `
                        <div class="mb-5 p-6 bg-orange-50 border-l-4 border-orange-500 rounded-r-lg">
                            <div class="flex items-center">
                                <h3 class="text-orange-800 font-medium">${res.details}</h3>
                            </div>
                        </div>`;
                document.getElementById("expanded-results").innerHTML =
                  noresult;
              }
              if (res.length > 0) {
                expandBtn.innerHTML =
                  document.getElementById("label-check").textContent;

                let costTime = 0;
                const html = res.map((obj) => {
                  costTime += Number(obj.alltime);
                  return generateHtmlString(obj);
                });

                document.getElementById("expanded-results").innerHTML = html;
                document.getElementById("cost-card").classList.remove("hidden");
                document.getElementById("cost-at").textContent = res[0].time;

                document.getElementById("cost-time").textContent = costTime;
              }
            })
            .catch((err) => {
              expandBtn.innerHTML =
                document.getElementById("label-check").textContent;
              document.getElementById("cost-card").classList.add("hidden");
            });
        };

        expandForm.addEventListener("submit", function (e) {
          e.preventDefault();
          submitFunc();
        });

        // check again
        document
          .getElementById("check-again-btn")
          .addEventListener("click", function (e) {
            e.preventDefault();
            submitFunc(true);
          });

        const generateHtmlString = (obj) => {
          const labelShowMore =
            document.getElementById("label-show-more").textContent;
          const labelShowLess =
            document.getElementById("label-show-less").textContent;
          const labelStatusCode =
            document.getElementById("label-status-code").textContent;
          const labelTaken = document.getElementById("label-taken").textContent;

          const headerInfoHtml = Object.entries(obj.header).map(
            ([key, value]) => {
              return `
                            <div class="p-4 border-b border-solid border-gray-200">
                                <div class="flex justify-between">
                                    <div class="flex items-center px-2 shrink-0">
                                        <p class="text-sm font-semibold text-black whitespace-normal">${key}</p> 
                                    </div>
                                    <div class="px-2 max-w-[400px]">
                                        <p class="text-sm text-gray-500 whitespace-normal break-all">${value}</p> 
                                    </div>
                                </div>
                            </div>
                        `;
            }
          );
          // add server badge if server header exist
          // badge looks green background
          const serverBadge = obj.header.edge
            ? `<span class="inline-block w-full sm:w-auto py-1 px-2 mb-2 text-center font-semibold text-white bg-green-500 rounded">${obj.header.server}</span>`
            : "";

          const strhtml = `
                    <div class="expand-result-item border-b border-solid border-black border-opacity-5 pb-7 xl:pb-9 mb-7 xl:mb-9">
                        <div
                            class="lg:flex lg:items-center lg:justify-between  "
                        >
                            <div class="w-full lg:w-7/12">
                                <div class="sm:flex sm:items-center mb-6 lg:mb-0">
                                    <div>
                                        <a
                                            class="inline-flex items-center mb-4 text-lg font-heading font-semibold text-black hover:underline"
                                            href="${obj.url}"
                                            target="_blank"
                                        >
                                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none">
                                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM8.65 14.77C8.54 15.07 8.25 15.26 7.95 15.26C7.86 15.26 7.78 15.25 7.69 15.21C6.88 14.91 6.2 14.32 5.77 13.55C4.77 11.75 5.39 9.4 7.14 8.31L9.48 6.86C10.34 6.33 11.35 6.17 12.31 6.42C13.27 6.67 14.08 7.3 14.57 8.18C15.57 9.98 14.95 12.33 13.2 13.42L12.94 13.61C12.6 13.85 12.13 13.77 11.89 13.44C11.65 13.1 11.73 12.63 12.06 12.39L12.37 12.17C13.49 11.47 13.87 10.02 13.26 8.91C12.97 8.39 12.5 8.02 11.94 7.87C11.38 7.72 10.79 7.81 10.28 8.13L7.92 9.59C6.84 10.26 6.46 11.71 7.07 12.83C7.32 13.28 7.72 13.63 8.2 13.81C8.59 13.95 8.79 14.38 8.65 14.77ZM16.92 15.65L14.58 17.1C13.99 17.47 13.33 17.65 12.66 17.65C12.36 17.65 12.05 17.61 11.75 17.53C10.79 17.28 9.98 16.65 9.5 15.77C8.5 13.97 9.12 11.62 10.87 10.53L11.13 10.34C11.47 10.1 11.94 10.18 12.18 10.51C12.42 10.85 12.34 11.32 12.01 11.56L11.7 11.78C10.58 12.48 10.2 13.93 10.81 15.04C11.1 15.56 11.57 15.93 12.13 16.08C12.69 16.23 13.28 16.14 13.79 15.82L16.13 14.37C17.21 13.7 17.59 12.25 16.98 11.13C16.73 10.68 16.33 10.33 15.85 10.15C15.46 10.01 15.26 9.58 15.41 9.19C15.55 8.8 15.99 8.6 16.37 8.75C17.18 9.05 17.86 9.64 18.29 10.41C19.28 12.21 18.67 14.56 16.92 15.65Z" fill="#292D32"/>
                                        </svg> 
                                        ${obj.url.split("?")[0]}
                                        </a>
                                        <div class="flex flex-wrap">
                                            <p class="mr-4 text-sm font-heading font-semibold text-black">
                                                <span>${labelStatusCode}</span>
                                                <span class="ml-2 text-gray-400 font-body">${
                                                  obj.http_code
                                                }</span>
                                            </p> 
                                            <p class="mr-4 text-sm font-heading font-semibold text-black">
                                                <span>${labelTaken}</span>
                                                <span class="ml-2 text-gray-400 font-body">${
                                                  obj.alltime
                                                }s</span>
                                            </p> 
                                            <p class="text-sm font-heading font-semibold text-black">
                                                <span>IP:</span>
                                                <span class="ml-2 text-gray-400 font-body">${
                                                  obj.ip
                                                }</span>
                                            ${serverBadge}
                                            </p> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:w-4/12 xl:w-3/12 2xl:w-2/12">
                                <div
                                    class="flex flex-end flex-wrap lg:justify-end "
                                >
                                    <p
                                        class="flex items-center text-sm text-blue-500 font-heading font-medium"
                                    >
                                            <a class="inline-block w-full sm:w-auto py-2 px-5 mb-2 text-center font-semibold leading-6 text-blue-50 bg-black hover:bg-[#5D2DFF] rounded transition duration-200 header-show-btn" href="javascript:;">${labelShowMore}</a>
                                    </p> 
                                </div>
                            </div>
                        </div>

                        <div class="more-info bg-gray-100 mt-4 hidden">
                            <div class="w-full">
                                <div class="rounded">
                                    ${headerInfoHtml.join("")}
                                </div>
                            </div>
                        </div>

                    </div>
                    `;

          return strhtml;
        };

        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("header-show-btn")) {
            e.preventDefault();
            const expandResultItem = e.target.closest(".expand-result-item");
            const moreInfo = expandResultItem.querySelector(".more-info");
            moreInfo.classList.toggle("hidden");

            if (
              e.target.textContent ===
              document.getElementById("label-show-more").textContent
            ) {
              e.target.textContent =
                document.getElementById("label-show-less").textContent;
            } else {
              e.target.textContent =
                document.getElementById("label-show-more").textContent;
            }
          }
        });
      });
    </script>
  </body>
</html>
